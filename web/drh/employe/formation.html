<div ng-controller="FormationController">
   <div class="panel box box-primary box-solid" ng-if="estPermanent && avoirPermission('consulter', 'formation') == true">
                <a data-toggle="collapse" data-parent="#accordion" href="" data-target="#formation" class="box-header with-border">
                    <div >
                        <i class="fa fa-book"></i>
                        <h1 class="box-title ">Formation</h1>
                    </div>
                </a>

                <div id="formation" class="panel-collapse collapse">

                    <form role="form" class="formationForm" name="newFormationForm" id="newFormationForm" novalidate="" ng-if="avoirPermission('ajouter', 'formation') == true">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Libelle</th>
                                        <th>Date début</th>
                                        <th>Date fin</th>
                                        <th>Diplomante</th>
                                        <th><span ng-if="diplomante">Nom diplome</span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <input type="text" name="libelle" ng-pattern="/^[a-zâäàéèùêëîïôöçñ]+[a-zâäàéèùêëîïôöçñ .\-']*[a-zâäàéèùêëîïôöçñ]+$/i" ng-model="formation.libelle" ng-minlength="2" class="form-control" id="libelle">
                                                </div>
                                                <div class="alert alert-block alert-danger requis" style="display:none">
                                                    <div>Veuillez renseigner ce champs.</div>
                                                </div>
                                                <div ng-messages="newFormationForm.libelle.$error" role="alert" ng-show="newFormationForm.libelle.$touched && newFormationForm.libelle.$invalid" class="alert alert-block alert-danger has-error">
                                                    <div ng-message="minlength">Ce champs doit contenir 2 chiffres minimum.</div>
                                                    <div ng-message="pattern">Vérifier votre saisie.</div>
                                                </div>

                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <input type="date" ng-model="formation.dateDebut" max="{{today}}" name="dateDebut" class="form-control" id="dateDebut" > 
                                                </div>
                                                <div class="alert alert-block alert-danger requis" style="display:none">
                                                    <div>Veuillez renseigner ce champs.</div>
                                                </div>
                                                <div ng-messages="newFormationForm.dateDebut.$error" role="alert" ng-show="newFormationForm.dateDebut.$invalid"  class="alert alert-block alert-danger has-error">
                                                    <div ng-message="max">Cette date ne doit pas dépasser la date actuelle</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <input type="date" ng-model="formation.dateFin"  name="dateFin" min="{{dateDebut}}" max="{{today}}" class="form-control" id="dateFin" > 
                                                </div>
                                                <div class="alert alert-block alert-danger requis" style="display:none">
                                                    <div>Veuillez renseigner ce champs.</div>
                                                </div>
                                                <div ng-messages="newFormationForm.dateFin.$error" role="alert" ng-show="newFormationForm.dateFin.$invalid"  class="alert alert-block alert-danger has-error">
                                                    <div ng-message="min">Cette date doit etre superieure à la date de début</div>
                                                    <div ng-message="max">Cette date ne doit pas dépasser la date actuelle</div>
                                                </div>

                                            </div>
                                        </td>
                                        <td>
                                            <input type="checkbox" id="diplomante" ng-click="toggleDiplomante()">
                                        </td>
                                        <td>
                                            <div class="form-group" ng-if="diplomante">
                                                <div class="input-group">
                                                    <input type="text" name="libelleDiplome" ng-pattern="/^[a-zâäàéèùêëîïôöçñ]+[a-zâäàéèùêëîïôöçñ .\-']*[a-zâäàéèùêëîïôöçñ]+$/i" ng-model="diplome.nom" ng-minlength="2" class="form-control" id="libelleDiplome">
                                                </div>
                                                <div class="alert alert-block alert-danger requis" style="display:none">
                                                    <div>Veuillez renseigner ce champs.</div>
                                                </div>
                                                <div ng-messages="newFormationForm.libelleDiplome.$error" role="alert" ng-show="newFormationForm.libelleDiplome.$touched && newFormationForm.libelleDiplome.$invalid" class="alert alert-block alert-danger has-error">
                                                    <div ng-message="minlength">Ce champs doit contenir 2 chiffres minimum.</div>
                                                    <div ng-message="pattern">Vérifier votre saisie.</div>
                                                </div>

                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Type de document</th>
                                        <th>Description</th>
                                        <th colspan="3">Actions</th>
                                    </tr>
                                    <tr>                                            
                                        <td>
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <select ng-model="document.typeDocument" class="form-control" id="entite" ng-options="typedocument.code  for typedocument in typedocuments"></select>  
                                                </div>
                                                <div class="alert alert-block alert-danger requis type-doc-missing" style="display:none">
                                                    <div>Veuillez renseigner ce champs.</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <textarea  cols="50" style="height: 140px; resize: none;"  ng-model="document.description" name="document" placeholder="Description du document" ></textarea>
                                                </div>
                                                <div class="alert alert-block alert-danger requis" style="display:none">
                                                    <div>Veuillez renseigner ce champs.</div>
                                                </div>                                      
                                            </div>
                                        </td>

                                        <td colspan="3">
                                            <div class="row">
                                                <div class="col-md-7">
                                                    <div class="detailUpload">
                                                    </div>
                                                    <div>                                     
                                                        <div class="alert alert-block alert-danger requis missing-file" style="display:none">
                                                            <div>Veuillez sélectionner un fichier.</div>
                                                        </div>
                                                        <div class="alert alert-block alert-danger requis error-format" style="display:none">
                                                            <div>Vérifier que le(s) fichier(s) envoyé(s) sont au bon format.</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <input class="form-control hidden" multiple  type="file"  onchange="angular.element(this).scope().previewUpload(this, 'newFormationForm')" name="fichiers" accept="application/pdf" id="fichiersFormation">
                                                    <label for="fichiersFormation">
                                                        <span class="btn btn-primary" title="Pièce jointe" ><i class="fa fa-paperclip"></i></span>
                                                    </label>
                                                    <span class="btn btn-danger" title="Annuler l'upload" ng-click="cancelFileUpload()">
                                                        <i class="fa fa-times" ></i>
                                                    </span>
                                                </div>                                       
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>

                                        </td>
                                        <td>

                                        </td>
                                        <td>

                                        </td>
                                        <td colspan="2">                                              
                                            <button ng-click="controlFormationFormation('newFormationForm')" ng-disabled="newFormationForm.$invalid" class="btn btn-success">
                                                <i class="fa fa-plus"> Ajouter</i>
                                            </button> 
                                            <button ng-click="reinitialiserFormulaireFormation()"  class="btn btn-danger">
                                                <i class="fa fa-times"> Annuler</i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </form>
               <!--     <div ng-if="formations.length > 0">

                        <div class="panel-body table-responsive no-padding">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Libelle</th>
                                        <th>Date debut</th>
                                        <th>Date fin</th>
                                        <th>Diplomante</th>
                                        <th>Diplome</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="formation in formations">

                                        <td>{{ formation.libelle}}</td>  
                                        <td>{{ formation.dateDebut | date: 'dd MMM yyyy' }}</td> 
                                        <td>{{ formation.dateFin | date: 'dd MMM yyyy'}}</td> 
                                        <td>
                                            <input type="checkbox" disabled="disabled" ng-checked="{{(formation.diplome !=null) ? true : false}}">
                                        </td> 
                                        <td>{{(formation.diplome !=null) ? formation.diplome.nom : ""}}</td> 
                                        <td class="col-md-3">
                                            <div class="row col-md-12">
                                                <div class="col-md-3">
                                                    <button ng-click="visualiserDocumentformation(formation.id)" class="btn btn-primary"><i class="fa fa-eye"></i></button>
                                                </div>
                                                <div class="col-md-3">
                                                    <button class="btn btn-danger" ng-if="groupeUtilisateur.code == 'DRH_AD'" ng-click="deleteFormationAndDocument(formation.id)"><i class="fa fa-trash"></i></button>
                                                </div>
                                            </div>
                                        </td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>


                    </div> -->
                <div >
                    <table class="table table-striped">
                            <thead>
                                <tr>
                                     <th>Libelle</th>
                                        <th>Date debut</th>
                                        <th>Date fin</th>
                                        <th>Diplome</th>
                                        <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody ng-repeat="formation in formations"> 
                                <tr>
                                    <td>{{ formation.libelle}}</td>  
                                        <td>{{ formation.dateDebut | date: 'dd MMM yyyy' }}</td> 
                                        <td>{{ formation.dateFin | date: 'dd MMM yyyy'}}</td> 
                                        <td>{{(formation.diplome !=null) ? formation.diplome.nom : "Pas de diplome"}}</td>
                                    <td>
                                        <button class="btn btn-danger" ng-if="groupeUtilisateur.code == 'DRH_AD'" ng-click="deleteFormationAndDocument(formation.id)"><i class="fa fa-trash"></i></button>
                                        <button class="btn btn-primary" type="button" data-toggle="collapse"
                                                data-target="#documentsAssociésConjoint{{$index}}" aria-expanded="false" aria-controls="documentsAssociésConjoint{{$index}}"
                                                ng-if="avoirPermission('lister', 'document') == true">
                                            <i class="fa fa-book"></i>
                                        </button>
                                    </td>                                   
                                </tr>
                                <tr>
                                    <td colspan="4" class="collapse" id="documentsAssociésConjoint{{$index}}">
                                        <table class="table table-striped table-bordered tableau-document">
                                            <thead>
                                                <tr>
                                                    <th>Libelle</th>
                                                    <th>Date debut</th>
                                                    <th>Date fin</th>
                                                    <th>Diplomante</th>
                                                    <th>Diplome</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody> 
                                                <tr ng-repeat="doc in $parent.documents" ng-if="angular.isDefined(doc.formation) && formation.id == doc.formation.id">
                                                    <td>{{ doc.formation.libelle}}</td>  
                                                    <td>{{ doc.formation.dateDebut | date: 'dd MMM yyyy' }}</td> 
                                                    <td>{{ doc.formation.dateFin | date: 'dd MMM yyyy'}}</td> 
                                                    <td>
                                                        <input type="checkbox" disabled="disabled" ng-checked="{{(formation.diplome !=null) ? true : false}}">
                                                    </td> 
                                                    <td>{{(doc.formation.diplome !=null) ? doc.formation.diplome.nom : ""}}</td>

                                                    
                                                   
                                                    <td>
                                                        <div>
                                                            <a class="btn btn-primary" ng-click="visualiserDocument(doc.emplacement)">
                                                                <i class="fa fa-eye"></i>
                                                            </a>
                                                            <button class="btn btn-danger" ng-if="avoirPermission('supprimer', 'document') == true"
                                                                    ng-click="deleteDocument(doc)"><i class="fa fa-trash"></i></button>
                                                        </div>
                                                    </td>

                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                       </div>
                </div>
            </div>
</div>